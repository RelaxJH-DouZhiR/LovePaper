# SAMURAI: Adapting Segment Anything Model for Zero-Shot Visual Tracking with Motion-Aware Memory

- arXiv

- [paper](https://arxiv.org/pdf/2411.11922)

- Qwen2.5 & doubao

- [ ] 人工修正（使用*斜体标注*）

## 动机

Segment Anything Model 2 (SAM 2) 在对象分割任务中展示了强大的性能，但在视觉对象跟踪（VOT）场景中遇到了挑战，特别是在处理快速移动或自遮挡的对象时。此外，SAM 2 的固定窗口记忆方法在选择用于调节下一帧图像特征的记忆时，不考虑记忆的质量，导致视频中的错误传播。为了应对这些局限性，研究人员提出了 SAMURAI，这是对 SAM 2 的增强适配，旨在通过结合时间运动线索和提出的运动感知记忆选择机制来实现无需重新训练或微调即可进行稳健、准确的跟踪。SAMURAI 专注于解决拥挤场景下的混淆问题以及遮挡期间无效的记忆利用问题，从而提高了视觉对象跟踪的准确性，并在多个基准数据集上实现了显著改进。

## 创新点

1. 我们通过引入运动建模，增强了SAM 2的视觉跟踪精度，能够有效处理快速移动和被遮挡的物体。
2. 我们提出了一种基于运动感知的记忆选择机制，通过根据运动和亲和度得分的混合选择性地存储相关帧，相比于原始的固定窗口记忆，减少了在拥挤场景中的错误。
3. 我们的零样本SAMURAI在LaSOT、LaSOText、GOT-10k和其他VOT基准上实现了最先进的性能，无需额外的训练或微调，展示了我们提出的模块在不同数据集上的强大泛化能力。

## 与现有方法的区别

模型架构与设计理念
1. **基于SAM 2的改进**：SAMURAI是在Segment Anything Model 2（SAM 2）的基础上进行增强和改进的。SAM 2本身在对象分割任务中表现出色，但在视觉对象跟踪方面面临挑战。SAMURAI针对这些挑战进行了专门设计，通过引入运动建模和运动感知记忆选择机制，使其更适应视觉对象跟踪任务的需求，而现有方法可能基于不同的模型架构或未针对SAM 2在跟踪任务中的问题进行优化。
2. **统一框架设计**：SAMURAI旨在提供一个统一的框架来解决视觉对象跟踪中的各种问题，将运动信息与记忆管理有机结合，以实现更准确和稳健的跟踪。相比之下，现有方法可能采用不同的模块组合或缺乏这种一体化的设计思路，导致在处理复杂跟踪场景时可能无法有效整合各种信息。

处理复杂场景的能力
1. **运动建模应对快速运动和遮挡**
    - **运动线索利用**：SAMURAI通过引入基于卡尔曼滤波器的运动建模，能够有效利用时间运动线索来预测对象的运动轨迹。在面对快速移动或遮挡的对象时，这种方法可以更好地估计对象的位置变化，从而提高跟踪的准确性。例如，在目标对象被遮挡后重新出现或经历快速运动时，SAMURAI能够根据之前的运动信息更准确地重新定位目标，而许多现有方法可能在这种情况下容易出现跟踪丢失或错误定位的问题。
    - **遮挡处理改进**：对于遮挡场景，SAMURAI的运动感知记忆选择机制能够更智能地选择与当前跟踪任务相关的记忆帧，避免因固定窗口记忆方法引入不相关或低质量的记忆特征而导致的误差传播。相比之下，一些现有方法在处理遮挡时可能没有充分考虑记忆的有效性，从而在遮挡期间或遮挡后出现跟踪不稳定或错误的情况。
2. **复杂场景适应性**：在拥挤场景中，SAMURAI通过综合考虑运动和掩码亲和度等信息，能够更好地区分目标对象与相似背景或其他干扰对象，减少混淆和错误预测的可能性。现有方法在处理具有相似外观对象的拥挤场景时，可能主要依赖于外观特征，忽略了运动信息的重要性，从而导致跟踪性能下降。

记忆管理策略
1. **运动感知记忆选择**：SAMURAI提出了一种创新的运动感知记忆选择机制，根据掩码亲和度、对象出现和运动得分等多个因素来选择性地存储和利用记忆帧。这种方法能够更灵活地适应不同场景下的记忆需求，确保记忆库中存储的是对当前跟踪最有价值的信息，从而提高跟踪的可靠性。与SAMURAI不同，现有方法的记忆管理策略可能较为简单，如采用固定窗口记忆或未充分考虑记忆特征的质量和相关性，容易在复杂场景下引入错误信息。
2. **减少误差传播**：通过优化记忆选择，SAMURAI有效地减少了因记忆错误或不相关而导致的误差传播问题。在长序列跟踪任务中，这一点尤为重要，因为误差传播可能会逐渐累积，导致跟踪性能严重下降。现有方法可能在处理长序列时由于记忆管理不善而出现跟踪漂移或丢失目标的情况，无法保持稳定的跟踪性能。

训练与泛化能力
1. **零样本性能优势**：SAMURAI在多个基准数据集上展现出了强大的零样本性能，无需额外训练或微调即可在不同数据集上取得显著的性能提升。这表明SAMURAI具有良好的泛化能力，能够直接应用于新的数据集和场景，而无需针对特定数据集进行复杂的训练过程。相比之下，许多现有方法可能需要大量的训练数据和繁琐的训练过程来优化模型参数，并且在不同数据集之间的泛化能力可能有限。
2. **对训练数据的依赖程度**：现有方法中，一些基于学习的跟踪器通常需要大量标注数据进行训练，以学习对象的特征表示和跟踪模式。然而，SAMURAI通过利用SAM 2在大规模分割数据集上的预训练优势，结合自身的改进机制，能够在较少依赖特定跟踪训练数据的情况下实现出色的跟踪性能，降低了对大规模标注跟踪数据的需求，提高了方法的实用性和灵活性。

## 详细方法

第一步：运动建模（Motion Modeling）
1. **状态向量定义**：采用基于线性的卡尔曼滤波器（Kalman Filter）进行运动建模。定义状态向量$(x = [x, y, w, h, \dot{x}, \dot{y}, \dot{w}, \dot{h}]^{T})$，其中$((x, y))$表示目标对象边界框的中心坐标，$(w)$和$(h)$分别为边界框的宽度和高度，$((\dot{x}, \dot{y}, \dot{w}, \dot{h}))$则是它们对应的速度。
2. **边界框与掩码关系**：对于每个掩码$(M_{i})$，通过计算掩码非零像素的最小和最大$(x)$、$(y)$坐标来得到对应的边界框$(d_{i})$。
3. **卡尔曼滤波预测与更新**
    - **预测步骤**：卡尔曼滤波器以预测 - 校正循环的方式工作。在预测阶段，根据当前状态$(\hat{x}_{t|t})$，使用线性状态转移矩阵$(F)$来预测下一时刻的状态$(\hat{x}_{t + 1|t})$，即$(\hat{x}_{t + 1|t} = F\hat{x}_{t|t})$。
    - **计算KF - IoU得分**：计算预测掩码$(M)$与由卡尔曼滤波器预测状态得到的边界框之间的IoU（Intersection over Union），得到KF - IoU得分$(s_{kf} = IoU(\hat{x}_{t + 1|t}, M))$。
    - **掩码选择**：选择使加权和最大的掩码$(M^{*})$，加权和由KF - IoU得分和原始掩码亲和度得分组成，即$(M^{*}=\underset{M_{i}}{arg max}(\alpha_{kf} \cdot s_{kf}(M_{i})+(1 - \alpha_{kf}) \cdot s_{mask}(M_{i})))$，其中$(\alpha_{kf})$是运动权重，用于平衡运动信息和掩码亲和度信息的重要性。
    - **更新步骤**：在校正阶段，使用测量值$(z_{t})$（即所选掩码对应的边界框）来更新状态估计$(\hat{x}_{t|t})$，更新公式为$(\hat{x}_{t|t}=\hat{x}_{t|t - 1}+K_{t}(z_{t}-H\hat{x}_{t|t - 1}))$，其中$(K_{t})$是卡尔曼增益，$(H)$是观察矩阵。为确保运动建模的稳健性，仅当在过去$(\tau_{kf})$帧中成功跟踪对象时，才考虑运动模块的更新。

第二步：运动感知记忆选择（Motion - Aware Memory Selection）
1. **选择标准设定**：原始SAM 2根据固定窗口选择前$(N_{mem})$帧来准备当前帧的条件视觉特征，但这种方法在处理较长遮挡或变形时存在弱点。为构建有效的考虑运动的对象线索记忆库，采用基于掩码亲和度得分、对象出现得分和运动得分的选择性方法选择帧。只有当这三个得分都满足各自对应的阈值（如$(\tau_{mask})$、$(\tau_{obj})$、$(\tau_{kf})$）时，才将该帧选为理想的记忆候选帧。
2. **记忆库构建**：从当前帧开始向后迭代，根据上述得分函数选择$(N_{mem})$个记忆，得到运动感知记忆库$(B_{t}=\{m_{i}|f(s_{mask}, s_{obj}, s_{kf}) = 1, t - N_{max} \leq i < t\})$，其中$(N_{max})$是向后查看的最大帧数。在实验中，遵循SAM 2训练时的设置$(N_{mem}=7)$。
3. **记忆库应用**：运动感知记忆库$(B_{t})$随后通过记忆注意力层，然后传递给掩码解码器$(Dmask)$，在当前时间戳执行掩码解码操作，从而为后续的掩码预测提供更准确、相关的历史信息。

通过以上两个关键步骤，SAMURAI在不进行重新训练或微调的情况下，增强了SAM 2在视觉对象跟踪中的性能，使其能够更好地处理复杂场景中的跟踪问题，如快速移动、遮挡和相似对象干扰等情况。

### 评价指标

AUC（Area Under the Curve）
1. **定义与计算方式**：AUC是通过计算跟踪结果与真实标注之间的曲线下面积来衡量跟踪器性能的指标。在不同的重叠阈值范围内，计算跟踪结果与真实标注的重叠比例，并绘制出曲线，该曲线下的面积即为AUC。AUC值越高，表示跟踪器在不同重叠阈值下的整体性能越好，能够更准确地跟踪目标对象。
2. **在实验中的应用场景**：在LaSOT、$(LaSOT_{ext})$、TrackingNet等数据集的实验中，AUC被广泛用于评估SAMURAI与其他跟踪方法的性能。例如，在LaSOT数据集上，通过比较不同模型的AUC值，可以直观地看出SAMURAI在跟踪准确性方面相对于其他方法的优势。

成功率（Success）
1. **定义与计算方式**：成功率衡量的是跟踪器在整个视频序列中成功跟踪目标对象的比例。通常根据跟踪结果与真实标注之间的重叠程度来判断是否成功跟踪。如果在一定帧数内，跟踪结果与真实标注的重叠面积超过了预设的阈值，则认为该帧跟踪成功。成功率越高，说明跟踪器在长时间跟踪目标对象时保持准确跟踪的能力越强。
2. **在实验中的应用场景**：在LaSOT和$(LaSOT_{ext})$数据集的实验中，成功率是一个重要的评价指标。通过绘制成功率曲线，展示不同重叠阈值下SAMURAI和其他方法的成功率变化情况，从而评估SAMURAI在不同场景下（如遮挡、相似对象干扰等）的跟踪稳定性和准确性。

精度（Precision）
1. **定义与计算方式**：精度主要评估跟踪器预测的目标位置与真实目标位置之间的偏差程度。通常使用跟踪结果与真实标注之间的中心位置误差或边界框的IoU（Intersection over Union）来衡量。中心位置误差越小或IoU越高，精度越高，表明跟踪器能够更精确地定位目标对象。
2. **在实验中的应用场景**：在LaSOT和$(LaSOT_{ext})$数据集的实验中，计算了不同阈值下的精度，如$(P_{norm})$（归一化精度），用于更准确地评估SAMURAI在目标定位方面的性能。通过比较不同模型在精度指标上的表现，可以了解SAMURAI在处理复杂场景（如快速运动、遮挡等）时保持精确跟踪的能力。

AO（Average Overlap）
1. **定义与计算方式**：AO是在GOT - 10k数据集实验中使用的一个评价指标，用于衡量跟踪器在整个视频序列中与真实标注的平均重叠程度。计算方法是在每一帧中计算跟踪结果与真实标注的IoU，并对所有帧的IoU求平均值。AO值越高，说明跟踪器在跟踪过程中与真实目标的匹配程度越好。
2. **在实验中的应用场景**：在GOT - 10k数据集上，AO被用于评估SAMURAI与其他跟踪器在该数据集上的性能差异。由于GOT - 10k数据集具有多样性和复杂性，AO能够全面反映跟踪器在不同场景下的跟踪效果，通过比较SAMURAI与其他方法的AO值，可以评估其在该数据集上的跟踪准确性和稳定性。

$(OP_{0.5})$（Overlap Precision at 0.5 threshold）
1. **定义与计算方式**：$(OP_{0.5})$表示在重叠阈值为0.5时的重叠精度。即计算跟踪结果与真实标注的IoU大于0.5的帧占总帧数的比例。这个指标重点关注跟踪器在较高重叠要求下的性能，能够反映跟踪器在精确跟踪目标方面的能力。
2. **在实验中的应用场景**：在GOT - 10k数据集的实验中，$(OP_{0.5})$与AO一起被用于评估SAMURAI在该数据集上的性能。通过分析SAMURAI在$(OP_{0.5})$指标上的表现，可以了解其在严格的重叠要求下的跟踪准确性，以及与其他跟踪器在该方面的差异。

通过使用这些多样化的评价指标，论文能够全面、客观地评估SAMURAI在不同数据集、不同场景下的视觉对象跟踪性能，为模型的改进和优化提供了有力的依据，同时也使得SAMURAI与其他跟踪方法之间的比较更加科学和准确。

### 每个研究问题的结果

SAMURAI在不同基准数据集上的跟踪性能如何？
1. **实验设置**
    - **数据集选择**：使用了多个VOT（Visual Object Tracking）基准数据集，包括LaSOT、$(LaSOT_{ext})$、GOT - 10k、TrackingNet、NFS和OTB100。这些数据集在对象类别、场景复杂性、遮挡情况等方面具有多样性，能够全面评估跟踪器的性能。
    - **评估指标**：采用了成功率（Success）、精度（Precision）、AUC（Area Under the Curve）等常见的跟踪性能评估指标。例如，在LaSOT和$(LaSOT_{ext})$数据集中，计算了不同重叠阈值下的成功率（Success）和归一化精度（$(P_{norm})$）；在GOT - 10k数据集中，使用了AO（Average Overlap）和$(OP_{0.5})$（Overlap Precision at 0.5 threshold）等指标。
2. **实验结果**
    - **LaSOT和$(LaSOT_{ext})$数据集**：SAMURAI在这两个数据集上表现出色，显著优于零样本和有监督方法。例如，在LaSOT数据集中，SAMURAI - L模型的AUC达到了74.2%，$(P_{norm})$为82.7%，成功率（Success）为74.2%；在$(LaSOT_{ext})$数据集中，SAMURAI - L模型的AUC为61.0%，$(P_{norm})$为73.9%，成功率（Success）为61.0%。与其他方法相比，SAMURAI在所有指标上均取得了领先或可比的成绩，展示了其强大的跟踪能力和泛化能力。
    - **GOT - 10k数据集**：SAMURAI模型在GOT - 10k数据集上也取得了优异的成绩。SAMURAI - B模型在AO指标上比SAM2.1 - B提高了2.1%，在$(OP_{0.5})$指标上提高了2.9%；SAMURAI - L模型在AO指标上提高了0.6%，在$(OP_{0.5})$指标上提高了0.7%。所有SAMURAI模型在该数据集上的各项指标均超越了现有方法，证明了其在处理复杂场景和不同对象运动模式下的有效性。
    - **TrackingNet、NFS和OTB100数据集**：在这些数据集上，SAMURAI同样表现出了良好的性能。例如，在TrackingNet数据集中，SAMURAI - L模型的AUC达到了85.3%，在NFS数据集中为69.2%，在OTB100数据集中为71.5%。与有监督方法相比，SAMURAI - L模型在这些数据集上的性能可与之媲美甚至超越，进一步证明了其在不同数据集上的泛化能力。

提出的运动建模和运动感知记忆选择模块对SAMURAI的性能有何影响？
1. **实验设置**
    - **模块单独评估**：通过设置不同的实验条件，分别评估运动建模和运动感知记忆选择模块对SAMURAI性能的影响。在评估运动建模模块时，对比了使用和不使用该模块时模型在跟踪准确性上的差异；在评估运动感知记忆选择模块时，研究了其对不同场景下（如遮挡、快速运动等）记忆特征选择的有效性，以及对最终跟踪结果的影响。
    - **参数敏感性分析**：对运动建模模块中的关键参数，如运动权重$(\alpha_{kf})$，进行了敏感性分析。通过调整$(\alpha_{kf})$的值，观察其对模型在AUC、$(P_{norm})$和精度等指标上的影响，以确定最佳的参数设置。
2. **实验结果**
    - **模块单独影响**：实验结果表明，两个模块均对SAMURAI的性能有积极影响。单独使用运动建模模块时，模型在LaSOT数据集上的AUC从68.32%提升到了72.67%；单独使用运动感知记忆选择模块时，AUC提升到了70.81%。当两个模块结合使用时，模型性能达到最佳，AUC为74.23%，$(P_{norm})$为82.69%，这表明两个模块相互补充，共同提升了SAMURAI在复杂场景下的跟踪准确性和鲁棒性。
    - **参数敏感性**：对运动权重$(\alpha_{kf})$的敏感性分析显示，当$(\alpha_{kf}=0.15)$时，模型在LaSOT数据集上取得了最佳的AUC（74.23%）和$(P_{norm})$（82.69%）成绩。这表明在平衡运动得分和掩码亲和度得分时，适当的权重设置能够优化模型的掩码选择，从而提高跟踪性能。

SAMURAI与基于SAM的基线跟踪方法相比有哪些优势？
1. **实验设置**
    - **对比方法选择**：选择了SAM2.1作为基线跟踪方法，与SAMURAI在相同的实验条件下进行比较。在LaSOT和$(LaSOT_{ext})$数据集上，对SAMURAI和SAM2.1在不同骨干网络变体（如T、S、B、L等）下的性能进行了详细对比，以确保比较的全面性和公正性。
    - **评估指标一致性**：使用与研究问题1中相同的评估指标，包括AUC、$(P_{norm})$、成功率（Success）等，对SAMURAI和SAM2.1进行性能评估，以便直接比较两者在跟踪准确性和鲁棒性方面的差异。
2. **实验结果**
    - **性能提升显著**：实验结果表明，SAMURAI在所有骨干网络变体上均显著优于SAM2.1基线方法。在LaSOT数据集上，SAMURAI - T模型的AUC比SAM2.1 - T提高了2.58%，$(P_{norm})$提高了2.69%，成功率（Success）提高了2.56%；SAMURAI - S模型的AUC提高了3.57%，$(P_{norm})$提高了3.88%，成功率（Success）提高了3.98%；SAMURAI - B模型的AUC提高了4.68%，$(P_{norm})$提高了4.15%，成功率（Success）提高了5.25%；SAMURAI - L模型的AUC提高了5.69%，$(P_{norm})$提高了6.53%，成功率（Success）提高了6.62%。在$(LaSOT_{ext})$数据集上也观察到了类似的显著性能提升，这充分证明了SAMURAI所提出的运动建模和运动感知记忆选择机制的有效性，使其能够在复杂场景下更准确地跟踪目标对象，减少错误传播，提高跟踪的鲁棒性和准确性。

SAMURAI在不同属性场景下的性能表现如何？
1. **实验设置**
    - **属性定义依据**：根据LaSOT和$(LaSOT_{ext})$数据集中定义的14种属性，对SAMURAI在不同属性场景下的性能进行分析。这些属性涵盖了相机运动（CM）、快速运动（FM）、遮挡（如全遮挡FOC、部分遮挡POC）、光照变化（IV）等多种常见的视觉跟踪挑战场景，能够全面评估SAMURAI在不同复杂情况下的跟踪能力。
    - **性能评估方式**：针对每个属性，计算SAMURAI与基线方法（如SAM2.1）在AUC指标上的差异，以量化分析SAMURAI在不同属性场景下的性能提升或变化情况。同时，通过观察在不同属性场景下跟踪结果的可视化示例，直观地评估SAMURAI的性能表现。
2. **实验结果**
    - **总体性能提升**：SAMURAI在大多数属性场景下均表现出优于基线的性能。在LaSOT数据集中，SAMURAI - B模型在多个属性上取得了显著的性能提升，如在相机运动（CM）属性上，AUC提升了8.3%；在快速运动（FM）属性上，AUC提升了7.3%；在全遮挡（FOC）和部分遮挡（POC）等与遮挡相关的属性上，AUC也分别提升了11.4%和14.8%。SAMURAI - L模型同样在多个属性上有出色表现，在CM属性上AUC提升了8.1%，在FM属性上提升了6.9%，在FOC和POC属性上分别提升了9.4%和7.8%。在$(LaSOT_{ext})$数据集上也观察到了类似的趋势，尽管在光照变化（IV）属性上SAMURAI - L模型的性能略有下降，但在其他属性上仍有显著提升，如在CM属性上AUC提升了16.5%，在FM属性上提升了9.9%。这些结果表明，SAMURAI通过考虑运动评分和运动感知记忆选择，能够更好地应对各种复杂属性场景下的跟踪挑战，尤其是在处理相机运动和快速运动场景时表现出色，同时在遮挡相关场景下也有显著的性能提升，增强了模型在复杂跟踪场景下的鲁棒性。

SAMURAI的运行时性能如何？
1. **实验设置**
    - **硬件平台选择**：在一台NVIDIA RTX 4090 GPU上进行运行时性能测试，以确保测试环境的一致性和可比性。选择该高端GPU是因为它能够提供足够的计算资源来运行复杂的视觉跟踪模型，并准确测量模型在实际硬件上的运行时间。
    - **运行时间测量**：测量SAMURAI在跟踪过程中的运行时间，包括图像编码、记忆注意力计算、掩码解码等各个关键步骤的时间消耗。同时，将SAMURAI的运行时间与基线模型（SAM2.1）进行对比，以评估所提出的运动建模和记忆选择方法对运行时性能的影响。
2. **实验结果**
    - **运行时开销小**：实验结果显示，将运动建模和增强的记忆选择方法集成到跟踪框架中仅引入了极小的计算开销。SAMURAI在运行时的性能与基线模型（SAM2.1）基本保持一致，这意味着在不牺牲运行效率的前提下，SAMURAI能够有效地提升跟踪性能。这一特性使得SAMURAI在实际应用中具有很大的优势，特别是在对实时性要求较高的视觉跟踪场景中，能够在保证快速响应的同时提供更准确的跟踪结果。