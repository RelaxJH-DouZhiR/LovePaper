# An Empirical Study of Static Analysis Tools for Secure Code Review

- International Symposium on Software Testing and Analysis 2024

- [paper](https://dl.acm.org/doi/pdf/10.1145/3650212.3680313)

- Qwen2.5

- [x] 人工修正

## 动机

本文的写作动机在于研究静态应用安全测试工具（SAST）在支持安全代码审查中的实际有效性。尽管有研究表明SAST可以提高安全问题的识别能力，但对于SAST在实际代码审查过程中支持作用的理解仍然有限。此外，大多数关于SAST的研究依赖于合成数据或完全易受攻击的程序版本，这些可能无法准确代表真实世界代码变更的情况。因此，作者旨在通过使用包含实际代码变更的数据集来填补这一空白，以更准确地评估SAST在检测导致可利用漏洞的代码变更方面的表现，并量化当变更函数根据SAST警告优先排序时可能带来的好处。

## 创新点

1. 调查在92个不同应用领域的项目中，C和C++静态应用安全测试（SAST）在引入真实世界漏洞的代码提交（这些提交经过代码审查）上的有效性，涵盖了八种类型的CWE漏洞。
2. 调查C和C++静态应用安全测试（SAST）在92个不同应用领域项目中，经过代码审查的代码提交上引入的真实世界漏洞的有效性，涵盖八种类型的CWE漏洞。
3. 提供一个多功能且可扩展的自动化基准测试框架，用于使用各种编程语言的开源代码提交数据集评估静态应用安全测试（SAST）。
4. *发布一个注释数据集，其中包含1064个易受攻击的文件和1060个易受攻击的函数，涵盖815个提交。*

## 详细方法

首先，作者们构建了一个包含实际代码变更的数据集，该数据集由92个C和C++项目的319个真实世界漏洞组成，这些漏洞来源于815个引入漏洞的提交记录（VCCs）。为了确保数据集的质量，他们验证了易受攻击的变更，并排除了无法链接到修复提交或因项目重命名而冗余的提交。

然后，作者选择了五种流行的SAST工具进行研究，这些工具是实践中开发人员可以采用的。在选择SAST工具时，作者遵循了工具开发者强烈推荐的默认规则设置，因为不同的规则启用情况可能会影响工具的一般有效性。同时，他们在尝试启用额外规则时遇到了内存不足的问题。

作者还开发了一个灵活且可扩展的自动化基准测试框架，用于使用开源代码提交数据集评估SAST工具在各种编程语言中的表现。此框架允许研究者和实践者更好地理解这些工具在协助代码审查者识别潜在漏洞方面的能力。

接下来，为了研究基于警告的优先级对漏洞识别的影响，作者设计了三种优先级策略：警告数量（WA）、警告密度（WD）以及警告严重性（WS）。他们分析了在固定努力量下（按代码行数百分比计算），使用这些优先级策略可以识别多少易受攻击的函数。此外，作者手动映射了警告与CWE类别之间的关系，并评估了警告的准确性，以减少人为偏见的影响。

最后，作者探讨了SAST工具执行的时间开销，这是之前的研究中较少涉及的一个方面。他们测量了每个工具在处理选定的VCCs时所需的计算时间，以了解这些工具在实际开发环境中可能产生的影响。

## 研究问题

- **RQ1** 有效性: 静态应用安全测试工具（SASTs）在检测导致漏洞的提交记录中的漏洞方面有多有效？
- **RQ2** 基于警告的优先级排序: 如何利用SAST警告为安全代码审查优先排序变更？
- **RQ3** 计算时间: SAST工具执行所需的时间是多少？

### 评价指标

- **Precision（精度）**：正确识别出的易受攻击函数占所有被标记为可能存在漏洞的函数的比例。
- **Recall（召回率）**：正确识别出的易受攻击函数占所有实际易受攻击函数的比例。
- **Initial False Alarm (IFA)**：在首次遇到真正存在漏洞的函数前，需要检查的非易受攻击函数的代码行数比例。
- **False Positive Rate (FPR)**：无关警告占总警告的比例，即错误地将安全的代码标识为可能存在漏洞的比例。
- **True Positive Rate (TPR)**：相关警告占总警告的比例，即正确地将存在漏洞的代码标识为可能存在漏洞的比例。
- **Warning Relevance**：警告与报告的漏洞的相关性，分为三个等级：相关、不相关和不确定。
- **Computational Time**：运行SAST工具处理特定代码变更所需的计算时间，用来衡量工具的效率。

### 每个研究问题的结果

**RQ1 效果性:**

- **实验设计**：为了回答SAST工具检测漏洞贡献提交记录中漏洞的有效性问题，研究者选择了五个满足特定标准的SAST工具（CodeChecker, CodeQL, Infer, Flawfinder, 和Cppcheck）对815个导致漏洞的代码提交进行了测试。这些工具在执行前都经过了适当的配置，以确保它们能够以最佳状态运行。
- **实验结果**：单个SAST工具可以在52%的导致漏洞的代码提交中产生警告。然而，至少76%的警告与导致漏洞的代码变更无关，且有22%的导致漏洞的代码提交由于SAST规则的限制未能被检测到。这些发现强调了SAST工具的优势以及存在的局限性。

**RQ2 基于警告的优先级排序:**

- **实验设计**：研究者探索了三种不同的优先级策略（警告数量、警告密度和警告严重性）来优化基于SAST警告的代码变更优先排序。目的是评估这些策略如何影响代码审查过程中识别潜在漏洞的效率。
- **实验结果**：使用警告密度（WD）对变更函数进行优先排序通常可以提供最大的改进，对于召回率（recall）的提升可达5.6%，对于初始误报（IFA）的减少可达13.3%。相比之下，警告严重性（WS）提供的性能提升最小。这表明，在实践中采用警告密度作为优先级策略可能更为有效。

**RQ3 计算时间:**

- **实验设计**：为了探究SAST工具的计算时间需求，研究者测量了每个工具处理一个导致漏洞的代码提交所需的平均时间。此外，他们还考察了系统大小（以代码行数衡量）对计算时间的影响。
- **实验结果**：实验结果显示，Flawfinder由于其语法分析方法无需编译，平均仅需20秒即可完成分析；而Cppcheck虽然结合了语义和语法技术但不需要编译，却意外地成为最耗时的工具，平均需要2702秒。CodeChecker、CodeQL和Infer这三款需要编译的工具，其平均计算时间则介于213至456秒之间。对于大型系统（超过10k-15k LOC），Cppcheck的计算时间显著增加，而当系统大小超过50k-100k LOC时，CodeQL、Infer和CodeChecker的计算时间也会变长。这些发现为理解不同工具在处理不同类型项目时的表现提供了重要信息。

## 有效性威胁

- **内部有效性威胁**：本研究中使用的漏洞贡献提交（VCCs）数据集的质量直接影响研究结果。虽然研究团队尽力确保数据集的质量，例如验证易受攻击的变更、排除无法链接到修复提交或因项目重命名而冗余的提交，但仍然可能存在未被发现的数据质量问题。此外，SAST工具的选择基于它们的流行度和适用性，这可能导致结果偏向于某些特定工具的性能特征，而非普遍适用于所有SAST工具。

- **构建有效性威胁**：构建有效性主要关注测量指标是否能准确反映所要研究的概念。研究假设评审员在代码审查过程中会优先考虑带有警告的变更函数。虽然这种假设在一定程度上反映了实际情况，但评审员可能会采取其他策略，这可能导致研究结果与现实情况存在差异。研究中使用了三种优先级策略（警告数量、警告密度和警告严重性）来提高结果的可靠性，但这并不能完全覆盖所有可能的评审策略。

- **外部有效性威胁**：外部有效性涉及研究结果的泛化能力。虽然本研究的数据集涵盖了92个不同应用领域的项目，具有较好的代表性，但所选的五个SAST工具可能无法完全代表市场上所有的SAST工具。因此，研究结果的泛化能力可能受到限制。此外，研究结果的有效性可能随时间变化，因为MITRE定期更新CWE和CVE条目，这意味着基于当前数据集的研究结果在未来可能不再成立。


## 未来展望

- **提高复杂代码的理解能力**：近期的工作表明，静态分析工具在检测复杂代码中的漏洞时可能受限于其对代码语义理解的不足。因此，未来的研究应探索能够提高工具对复杂代码理解能力的方法，以便更有效地检测漏洞。

- **开发有效的SAST使用技术**：尽管基于警告的优先排序可以帮助审查人员集中注意力于可能存在漏洞的代码段，但高误报率（超过76%）仍然是一个重大障碍。未来的研究需要探索更有效的技术，使SAST工具能够在保持较低误报率的同时，提高漏洞检测的准确性。

- **解决未检测到的漏洞问题**：研究结果显示，即使使用了多个SAST工具，仍有22%的导致漏洞的代码提交未能被任何工具检测到。这强调了改进SAST工具的重要性，特别是针对那些难以检测的漏洞类型。未来的研究应该寻找解决这些问题的方法，以减少未检测到的漏洞数量。

- **探索多工具组合方案**：虽然结合使用多个SAST工具可以提高漏洞检测的有效性，但对于资源有限的项目来说，这种方法可能不可行，尤其是对于大型项目。因此，未来的研究需要开发实用指南，帮助从业者根据项目特点合理选择和组合SAST工具。
